<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>glibc_compile</title>
    <link rel="stylesheet" href="../../../assets/css/notes.min.css">
</head>
<body>
    <div id="header-placeholder"></div>
    <div class="main-content-wrapper">
        <main class="content">
            <h1>glibc compile</h1>
<ul>
<li>
<p>源码下载：</p>
<ul>
<li><a href="https://launchpad.net/ubuntu/+source/glibc">https://launchpad.net/ubuntu/+source/glibc</a> （推荐该网站的源码，和下面gnu给的源码安装配置中有些许不同，适配ubuntu，基本不会出现一些报错的情况）</li>
<li><a href="http://ftp.gnu.org/gnu/glibc/">http://ftp.gnu.org/gnu/glibc/</a></li>
</ul>
</li>
<li>
<p>tar解压，并进入目录</p>
</li>
<li>
<pre><code class="language-shell">mkdir build;cd build

64位：
../configure --prefix=/path_you_want  --disable-werror --enable-debug=yes
32位：
../configure --prefix=/path_you_want --disable-werror --enable-debug=yes --host=i686-linux-gnu --build=i686-linux-gnu CC=&quot;gcc -m32&quot; CXX=&quot;g++ -m32&quot; 

make -j16
make install DESTDIR=/xxx/xxx/install
</code></pre>
</li>
</ul>
<p>glibc2.39 编译遇到的问题：</p>
<pre><code class="language-shell">syslog.c: In function ‘__vsyslog_internal’:
syslog.c:95:30: error: inlining failed in call to ‘always_inline’ ‘syslog’: function not inlinable
   95 | ldbl_strong_alias (__syslog, syslog)
      |                              ^~~~~~
./../include/libc-symbols.h:143:26: note: in definition of macro ‘_strong_alias’
  143 |   extern __typeof (name) aliasname __attribute__ ((alias (#name))) \
      |                          ^~~~~~~~~
../sysdeps/generic/math_ldbl_opt.h:14:44: note: in expansion of macro ‘strong_alias’
   14 | #define ldbl_strong_alias(name, aliasname) strong_alias (name, aliasname)
      |                                            ^~~~~~~~~~~~
syslog.c:95:1: note: in expansion of macro ‘ldbl_strong_alias’
   95 | ldbl_strong_alias (__syslog, syslog)
      | ^~~~~~~~~~~~~~~~~
syslog.c:138:7: note: called from here
  138 |       syslog (INTERNALLOG, &quot;syslog: unknown facility/priority: %x&quot;, pri);
      |       ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
      
      
make[2]: *** [../o-iterator.mk:9：/glibc/glibc_2.39.orig/glibc-2.39/build/misc/syslog.o] 错误 1
make[2]: *** 正在等待未完成的任务....
make[2]: 离开目录“/glibc/glibc_2.39.orig/glibc-2.39/misc”
make[1]: *** [Makefile:484：misc/subdir_lib] 错误 2
make[1]: 离开目录“/glibc/glibc_2.39.orig/glibc-2.39”
make: *** [Makefile:9：all] 错误 2

</code></pre>
<p>解决：对syslog.c的138行注释：</p>
<pre><code class="language-shell">//syslog (INTERNALLOG, &quot;syslog: unknown facility/priority: %x&quot;, pri);
</code></pre>
<p>遇到的问题：</p>
<pre><code class="language-shell">collect2: error: ld returned 1 exit status
</code></pre>
<p>解决：修改configure配置文件，7474行修改为：</p>
<pre><code class="language-shell">no_fortify_source=&quot;-U_FORTIFY_SOURCE&quot;
</code></pre>

        </main>
    </div>
    <footer class="footer">
        <p>&copy; 2024 waiwai24. All rights reserved.</p>
    </footer>
    <script src="../../../assets/js/header.js"></script>
    <script src="../../../assets/js/include-header.js"></script>
</body>
</html>