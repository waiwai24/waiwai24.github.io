<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title># 物理网卡与虚拟网卡,物理网卡与虚拟网卡</title>
    <link rel="stylesheet" href="/assets/css/notes.min.css">
</head>
<body>
    <div class="main-content-wrapper">
        <main class="content">
            <h1>物理网卡与虚拟网卡</h1>
<h2>1.物理网卡</h2>
<p>物理网卡主要与外界接收和发送数据：（内核和用户空间的数据传输由内核占用CPU来完成，内核和网卡之间的数据传输由网卡的DMA来完成）</p>
<ul>
<li>收：外界向该物理网卡发送数据时，外界发送到网卡的数据最终会传输到内核空间的网络协议栈中</li>
<li>发：本机要从物理网卡发送数据时，数据将从内核的网络协议栈传输到网卡，网卡负责将数据发送出去</li>
</ul>
<h2>2.虚拟网卡</h2>
<p>虚拟网卡的两端则是<strong>内核网络协议栈和用户空间</strong>，它负责在内核网络协议栈和用户空间的程序之间传递数据：</p>
<ul>
<li>发送到虚拟网卡的数据来自于用户空间，然后被内核读取到网络协议栈中</li>
<li>内核写入虚拟网卡准备通过该网卡发送的数据，目的地是用户空间</li>
</ul>
<p>只要为虚拟网卡提供网卡驱动程序，使其在内核中可以注册成为网卡设备，就可以成功使用，但对于虚拟网卡，使用ip命令都只是临时添加，重启失效</p>
<h3>2.1 tun/tap</h3>
<p>tun与tap都是虚拟网卡设备，tap比tun更接近于物理网卡，其主要区别如下：</p>
<table>
<thead>
<tr>
<th>tun</th>
<th>tap</th>
</tr>
</thead>
<tbody>
<tr>
<td>三层设备，外层封装ip头</td>
<td>两层设备，外层封装以太网帧头</td>
</tr>
<tr>
<td>ppp点对点设备，无mac地址</td>
<td>以太网设备，有mac地址</td>
</tr>
</tbody>
</table>
<p>用户空间对tun/tap驱动程序的操作的两种交互方式：虚拟网络接口和字符设备/dev/net/tun</p>
<ul>
<li>写入字符设备/dev/net/tun的数据会发送到虚拟网络接口中</li>
<li>发送到虚拟网络接口中的数据也会出现在该字符设备上</li>
</ul>
<p><img src="/0101/IOT/路由器类设备/assets/4.%E7%89%A9%E7%90%86%E7%BD%91%E5%8D%A1%E4%B8%8E%E8%99%9A%E6%8B%9F%E7%BD%91%E5%8D%A1/linux-tuntap.png" alt="img"></p>
<h3>2.2 virtual bridge</h3>
<p>安装：<code>apt-get install bridge-utils</code></p>
<p>bridge可以在两个或多个网络段之间转发数据包，bridge的行为类似于虚拟网络交换机</p>
<h2>3.物理网卡与虚拟网卡区别</h2>
<p>物理网卡是硬件网卡，它位于硬件层，虚拟网卡则可以看作是用户空间的网卡</p>
<p>他们能够达到的功能是相同的，唯一的区别就是传输数据的方式不同：物理网卡以比特流的方式传输数据，虚拟网卡则直接在内存中拷贝数据(即，在内核之间和读写虚拟网卡的程序之间传输）</p>
<p>所以，<strong>虚拟网卡不可能向外界发送数据，外界数据也不可能直接发送到虚拟网卡上</strong>，但是可以将网络数据发送到另一个虚拟/物理网卡上</p>

        </main>
    </div>
</body>
</html>