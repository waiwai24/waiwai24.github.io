<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title># 受限直接执行,受限直接执行</title>
    <link rel="stylesheet" href="../../../../assets/css/notes.min.css">
</head>
<body>
    <div id="header-placeholder"></div>
    <div class="main-content-wrapper">
        <main class="content">
            <h1>受限直接执行</h1>
<h2>1.基本概念</h2>
<p>受保护的控制权转移：</p>
<ul>
<li>用户模式(用户态):应用程序不能访问所有硬件资源</li>
<li>内核模式(内核态):0S可以访问机器的所有资源</li>
<li><img src="/0101/CSNote/操作系统/虚拟化/assets/2.%E5%8F%97%E9%99%90%E7%9B%B4%E6%8E%A5%E6%89%A7%E8%A1%8C/image-20241212231323102.png" alt="image-20241212231323102"></li>
</ul>
<p>RISC-V特权级：</p>
<ul>
<li>ABI:程序二进制接口</li>
<li>SB1:内核与硬件接口</li>
<li>SEE:安全执行环境</li>
</ul>
<p><img src="/0101/CSNote/操作系统/虚拟化/assets/2.%E5%8F%97%E9%99%90%E7%9B%B4%E6%8E%A5%E6%89%A7%E8%A1%8C/image-20240827104523971.png" alt="image-20240827104523971"></p>
<h2>2.中断和异常</h2>
<ul>
<li>中断和异常是事件，当OS启动后，所有对内核的访问都是由于事件导致的，事件发生后，转换为内核态，并且调用处理程序（控制程序保存程序状态、执行内核功能、恢复程序状态，继续执行）</li>
<li>中断
<ul>
<li>是异步的（与CPU当前指令无关），一般可以屏蔽</li>
<li>所有中断来的信号都是记录在中断寄存器中的，CPU在执行完一道指令之后，如果enable interrupt，就会检查中断寄存器中有没有中断，如果有中断，就会选择一个中断优先级比较高的中断先处理，等到处理完中断再继续执行；如果是disable interrupt，就不会检查是否有中断，而是直接执行下一条指令</li>
<li>常见的中断：IO中断，时钟中断</li>
</ul>
</li>
<li>异常
<ul>
<li>是同步的，不可屏蔽</li>
<li>异常发生的时候，CPU立即处理本次异常，直到异常处理结束之后才能继续进行接下来的任务。例如在进行程序调试的时候，添加一个断点，就必须在断点出发生异常，CPU立即处理，先暂停其工作，否则就无法查看断点处的程序运行信息。</li>
<li>常见的异常：除0错，算数溢出</li>
</ul>
</li>
</ul>
<p><img src="/0101/CSNote/操作系统/虚拟化/assets/2.%E5%8F%97%E9%99%90%E7%9B%B4%E6%8E%A5%E6%89%A7%E8%A1%8C/image-20240827105725167.png" alt="image-20240827105725167"></p>
<p>中断向量表:一片存放中断处理程序入口地址的内存单元，中断向量在内存中连续存放，起始地址一般记录在某特定寄存器，硬件按中断号的不同通过中断向量表跳转到相应处理程序中</p>
<h2>3.系统调用</h2>
<p><img src="/0101/CSNote/操作系统/虚拟化/assets/2.%E5%8F%97%E9%99%90%E7%9B%B4%E6%8E%A5%E6%89%A7%E8%A1%8C/image-20240827111955874.png" alt="image-20240827111955874"></p>
<p><img src="/0101/CSNote/操作系统/虚拟化/assets/2.%E5%8F%97%E9%99%90%E7%9B%B4%E6%8E%A5%E6%89%A7%E8%A1%8C/image-20240827112038185.png" alt="image-20240827112038185"></p>
<p>系统调用的实现：使用陷阱（trap）指令 （会产生一种异常）</p>
<p>xv6陷阱指令：ecall，对应的异常号8（u-mode）或9（s-mode），a7寄存器传递系统调用号</p>
<p>系统调用跟踪工具：strace</p>
<h2>4.操作系统运行模式</h2>
<p><img src="/0101/CSNote/操作系统/虚拟化/assets/2.%E5%8F%97%E9%99%90%E7%9B%B4%E6%8E%A5%E6%89%A7%E8%A1%8C/image-20240827115050872.png" alt="image-20240827115050872"></p>
<p>进入内核只有态的切换没有进程的切换</p>
<p><img src="/0101/CSNote/操作系统/虚拟化/assets/2.%E5%8F%97%E9%99%90%E7%9B%B4%E6%8E%A5%E6%89%A7%E8%A1%8C/image-20240827115117652.png" alt="image-20240827115117652"></p>
<p>优点：便于保证内核的正确性</p>
<p>缺点：内核的并发运行困难</p>
<p><img src="/0101/CSNote/操作系统/虚拟化/assets/2.%E5%8F%97%E9%99%90%E7%9B%B4%E6%8E%A5%E6%89%A7%E8%A1%8C/image-20240827115210683.png" alt="image-20240827115210683"></p>

        </main>
    </div>
    <footer class="footer">
        <p>&copy; 2024 waiwai24. All rights reserved.</p>
    </footer>
    <script src="../../../../assets/js/header.js"></script>
    <script src="../../../../assets/js/include-header.js"></script>
</body>
</html>