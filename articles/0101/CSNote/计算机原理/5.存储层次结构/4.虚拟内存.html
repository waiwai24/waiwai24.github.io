<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title># 虚拟内存,虚拟内存</title>
    <link rel="stylesheet" href="../../../../assets/css/notes.min.css">
</head>
<body>
    <div id="header-placeholder"></div>
    <div class="main-content-wrapper">
        <main class="content">
            <h1>虚拟内存</h1>
<p><img src="/0101/CSNote/计算机原理/5.存储层次结构/assets/4.%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98/image-20240711104108705.png" alt="image-20240711104108705"></p>
<blockquote>
<p><strong>CPU通过生成一个虚拟地址来访问主存，MMU（Memory Management Unit，内存管理单元）是一种硬件模块</strong>，用于在<strong>CPU和内存之间实现虚拟内存管理</strong></p>
</blockquote>
<h2>1.页</h2>
<ul>
<li>固定大小的块，作为磁盘和主存之间传输数据的基本单元</li>
<li>虚拟内存划分为虚拟页VP</li>
<li>物理内存划分为物理页PP，或称作页帧</li>
<li>虚拟地址的状态：
<ul>
<li>未分配的：无任何指向</li>
<li>缓存的：虚拟地址指向物理内存</li>
<li>未缓存的：虚拟地址指向磁盘</li>
</ul>
</li>
<li>虚拟页的状态：
<ul>
<li>未分配的：虚拟页还没分配磁盘空间</li>
<li>缓存的：虚拟页缓冲或映射在了物理页</li>
<li>未缓存的：虚拟页分配了磁盘空间，但没有在物理页上缓冲</li>
</ul>
</li>
<li><strong>页命中，缺页（引发替换）</strong></li>
</ul>
<h2>2.地址翻译</h2>
<p><strong>页表基址寄存器(PTBR）</strong></p>
<p>每个进程都有自己的页表，CPU执行某个进程时，会先把该进程的一级页表起始地址存储到页表基址寄存器，这样CPU查找一级页表起始地址可以直接从寄存器查找，加快了查找效率</p>
<p><img src="/0101/CSNote/计算机原理/5.存储层次结构/assets/4.%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98/image-20240711105949591.png" alt="image-20240711105949591"></p>
<p>虚拟地址(VA)组成：</p>
<ul>
<li>VPO: 虚拟页内偏移(Virtual page offset)</li>
<li>VPN:虚拟页号(Virtual page number)</li>
</ul>
<p>物理地址(PA)组成：</p>
<ul>
<li>PPO:物理页内偏移(Physical page offset)</li>
<li>PPN:物理页号(Physical page number)</li>
</ul>
<p>页内偏移量(page offset)的值不会随转换结果而变化,<strong>VPO = PPO</strong></p>
<h2>3.页表</h2>
<p>page table （PT）</p>
<ul>
<li>页表键虚拟页映射到物理页</li>
<li>页表内容由操作系统维护</li>
<li>页表是存放在物理内存当中的一个数据结构
<ul>
<li>页表是一个**页表条目（page table entry，PTE）**构成的数组</li>
<li>虚拟地址空间中每个页在页表中有一个固定偏移量处都有一个PTE</li>
<li>PTE由一个有效位和一个n位地址字段组成</li>
</ul>
</li>
</ul>
<p><img src="/0101/CSNote/计算机原理/5.存储层次结构/assets/4.%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98/image-20240711105220691.png" alt="image-20240711105220691"></p>
<h2>3.页面命中</h2>
<p><img src="/0101/CSNote/计算机原理/5.存储层次结构/assets/4.%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98/image-20240711110852635.png" alt="image-20240711110852635"></p>
<h2>4.缺页处理</h2>
<p><img src="/0101/CSNote/计算机原理/5.存储层次结构/assets/4.%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98/image-20240711110957079.png" alt="image-20240711110957079"></p>
<h2>5.利用TLB加速地址翻译</h2>
<p><img src="/0101/CSNote/计算机原理/5.存储层次结构/assets/4.%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98/image-20240715235638030.png" alt="image-20240715235638030"></p>
<ul>
<li>TLB：Translation Lookaside Buffer，快表</li>
<li>地址翻译需要两次存储器访问，非常低效。第一次是查询内存中的页表，第二次是访问物理页框</li>
<li>TLB集成与MMU中，仿照cache技术，进行缓存，访问TLB，就可以得到虚拟页对应的物理页</li>
</ul>
<p><img src="/0101/CSNote/计算机原理/5.存储层次结构/assets/4.%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98/image-20240711111323602.png" alt="image-20240711111323602"></p>

        </main>
    </div>
    <footer class="footer">
        <p>&copy; 2024 waiwai24. All rights reserved.</p>
    </footer>
    <script src="../../../../assets/js/header.js"></script>
    <script src="../../../../assets/js/include-header.js"></script>
</body>
</html>