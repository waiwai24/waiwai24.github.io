<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title># ELF Header,ELF Header</title>
    <link rel="stylesheet" href="/assets/css/notes.min.css">
</head>
<body>
    <div class="main-content-wrapper">
        <main class="content">
            <h1>ELF Header</h1>
<h2>1.ELF Header源码</h2>
<p>ELF Header 描述了 ELF 文件的概要信息，利用这个数据结构可以索引到 ELF 文件的全部信息，数据结构如下：</p>
<pre><code class="language-c">typedef struct
{
  unsigned char	e_ident[EI_NIDENT];	/* Magic number and other info */
  Elf32_Half	e_type;			/* Object file type */
  Elf32_Half	e_machine;		/* Architecture */
  Elf32_Word	e_version;		/* Object file version */
  Elf32_Addr	e_entry;		/* Entry point virtual address */
  Elf32_Off	e_phoff;		/* Program header table file offset */
  Elf32_Off	e_shoff;		/* Section header table file offset */
  Elf32_Word	e_flags;		/* Processor-specific flags */
  Elf32_Half	e_ehsize;		/* ELF header size in bytes */
  Elf32_Half	e_phentsize;		/* Program header table entry size */
  Elf32_Half	e_phnum;		/* Program header table entry count */
  Elf32_Half	e_shentsize;		/* Section header table entry size */
  Elf32_Half	e_shnum;		/* Section header table entry count */
  Elf32_Half	e_shstrndx;		/* Section header string table index */
} Elf32_Ehdr;
</code></pre>
<pre><code class="language-c">typedef struct
{
  unsigned char	e_ident[EI_NIDENT];	/* Magic number and other info */
  Elf64_Half	e_type;			/* Object file type */
  Elf64_Half	e_machine;		/* Architecture */
  Elf64_Word	e_version;		/* Object file version */
  Elf64_Addr	e_entry;		/* Entry point virtual address */
  Elf64_Off	e_phoff;		/* Program header table file offset */
  Elf64_Off	e_shoff;		/* Section header table file offset */
  Elf64_Word	e_flags;		/* Processor-specific flags */
  Elf64_Half	e_ehsize;		/* ELF header size in bytes */
  Elf64_Half	e_phentsize;		/* Program header table entry size */
  Elf64_Half	e_phnum;		/* Program header table entry count */
  Elf64_Half	e_shentsize;		/* Section header table entry size */
  Elf64_Half	e_shnum;		/* Section header table entry count */
  Elf64_Half	e_shstrndx;		/* Section header string table index */
} Elf64_Ehdr;
</code></pre>
<p>请求显示对象文件 hello.o 的头信息：</p>
<pre><code class="language-shell">$ readelf -h hello.o
ELF Header:
  Magic:   7f 45 4c 46 02 01 01 00 00 00 00 00 00 00 00 00
  Class:                             ELF64
  Data:                              2's complement, little endian
  Version:                           1 (current)
  OS/ABI:                            UNIX - System V
  ABI Version:                       0
  Type:                              REL (Relocatable file)
  Machine:                           Advanced Micro Devices X86-64
  Version:                           0x1
  Entry point address:               0x0
  Start of program headers:          0 (bytes into file)
  Start of section headers:          608 (bytes into file)
  Flags:                             0x0
  Size of this header:               64 (bytes)
  Size of program headers:           0 (bytes)
  Number of program headers:         0
  Size of section headers:           64 (bytes)
  Number of section headers:         14
  Section header string table index: 13
</code></pre>
<h2>2.e_ident</h2>
<p>e_ident 保存着 ELF 的<strong>幻数</strong>和其他信息，最前面四个字节是幻数（7f 45 4c 46），表示为 <code>0x7fELF</code></p>
<h2>3.e_type</h2>
<p>e_type 标识目标文件类型</p>
<h2>4.e_machine</h2>
<p>这一项指定了当前文件可以运行的机器架构</p>
<h2>5.e_version</h2>
<p>标识目标文件的版本</p>
<h2>6.e_entry</h2>
<p>这一项为系统转交控制权给 ELF 中相应代码的虚拟地址。如果没有相关的入口项，则这一项为 0</p>
<p>RVA:在内存中相对于模块基址的偏移</p>
<p>FOA：在文件中某个数据相对于文件开头的偏移</p>
<p>RVA和FOA不一定相同</p>
<h2>7.e_phoff</h2>
<p>这一项给出程序头部表在文件中的字节偏移（Program Header table OFFset）。如果文件中没有程序头部表，则为 0</p>
<h2>8.e_shoff</h2>
<p>这一项给出节头表在文件中的字节偏移（ Section Header table OFFset ）。如果文件中没有节头表，则为 0</p>
<h2>9.e_flags</h2>
<p>这一项给出文件中与特定处理器相关的标志，这些标志命名格式为EF_machine_flag</p>
<h2>10.e_ehsize</h2>
<p>这一项给出 ELF 文件头部的字节长度（ELF Header Size）</p>
<h2>11.e_phentsize</h2>
<p>这一项给出程序头部表中每个表项的字节长度（Program Header ENTry SIZE）。每个表项的大小相同</p>
<h2>12.e_phnum</h2>
<p>这一项给出程序头部表的项数（ Program Header entry NUMber ）。因此，e_phnum 与 e_phentsize 的乘积即为程序头部表的字节长度。如果文件中没有程序头部表，则该项值为 0</p>
<h2>13.e_shentsize</h2>
<p>这一项给出节头的字节长度（Section Header ENTry SIZE）。一个节头是节头表中的一项；节头表中所有项占据的空间大小相同</p>
<h2>14.e_shnum</h2>
<p>这一项给出节头表中的项数（Section Header NUMber）。因此， e_shnum 与 e_shentsize 的乘积即为节头表的字节长度。如果文件中没有节头表，则该项值为 0</p>
<h2>15.e_shstrndx</h2>
<p>这一项给出节头表中与节名字符串表相关的表项的索引值（Section Header table index related with section name string table）。如果文件中没有节名字符串表，则该项值为SHN_UNDEF。关于细节的介绍，请参考后面的 “节” 和“字符串表”部分</p>

        </main>
    </div>
</body>
</html>