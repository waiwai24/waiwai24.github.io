<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Project</title>
  <link rel="icon" href="favicon.png" type="image/png" />
  <link rel="stylesheet" href="style-project-tool.css" />
  <link rel="stylesheet" href="header-style.css" />
</head>
<body class="project-page">
  <header style="text-align: center;">
    <h1 class="page-title"><a href="index.html">Project</a></h1>
  </header>

  <main id="main-content" role="main">
    <div class="project-list" aria-live="polite">
      <a class="project-item" href="https://github.com/waiwai24/rust-c2-framework" target="_blank" rel="noopener" aria-label="rust-c2-framework 仓库">
        <img class="thumb" src="https://opengraph.githubassets.com/1/waiwai24/rust-c2-framework" alt="rust-c2-framework 仓库封面" loading="lazy" />
        <div class="meta">
          <h3 class="title">rust-c2-framework</h3>
          <p class="desc">Rust 编写的 C2 框架</p>
          <div class="repo-meta" data-repo="waiwai24/rust-c2-framework" aria-hidden="true">加载中...</div>
        </div>
      </a>

      <a class="project-item" href="https://github.com/waiwai24/0101" target="_blank" rel="noopener" aria-label="0101 仓库">
        <img class="thumb" src="https://opengraph.githubassets.com/1/waiwai24/0101" alt="0101 仓库封面" loading="lazy" />
        <div class="meta">
          <h3 class="title">0101</h3>
          <p class="desc">个人笔记仓库</p>
          <div class="repo-meta" data-repo="waiwai24/0101" aria-hidden="true">加载中...</div>
        </div>
      </a>
    </div>
  </main>

  <script>
    // 从 GitHub API 异步获取仓库元数据，并使用 localStorage 缓存
    (async function() {
      const metas = document.querySelectorAll('.repo-meta');
      if (!metas || metas.length === 0) return;

      const CACHE_DURATION = 3600 * 1000; // 缓存1小时

      const renderMeta = (el, data) => {
        const stars = data.stargazers_count ?? 0;
        const lang = data.language ?? '';
        const updated = data.updated_at ? new Date(data.updated_at).toLocaleDateString() : '';
        el.innerHTML = ''
          + '<span aria-hidden="true" style="display:inline-flex;align-items:center;gap:6px;"><i class="fas fa-star" style="color:#f4d35e"></i> ' + stars + '</span>'
          + (lang ? (' <span style="margin-left:8px"><svg width="10" height="10" viewBox="0 0 10 10" fill="currentColor" style="vertical-align:middle;margin-right:6px;border-radius:50%;opacity:0.9"></svg><strong>' + lang + '</strong></span>') : '')
          + (updated ? (' <span style="color:var(--muted);margin-left:10px">更新: ' + updated + '</span>') : '');
      };

      const renderError = (el, repo) => {
        el.textContent = '';
        const a = document.createElement('a');
        a.href = 'https://github.com/' + repo;
        a.target = '_blank';
        a.rel = 'noopener';
        a.textContent = '查看仓库';
        el.appendChild(a);
      };

      for (const el of metas) {
        const repo = el.dataset.repo;
        if (!repo) continue;

        const cacheKey = `repo_meta_${repo.replace('/', '_')}`;
        
        try {
          const cachedItem = localStorage.getItem(cacheKey);
          if (cachedItem) {
            const { data, timestamp } = JSON.parse(cachedItem);
            if (Date.now() - timestamp < CACHE_DURATION) {
              renderMeta(el, data);
              continue;
            }
          }

          const res = await fetch('https://api.github.com/repos/' + repo);
          if (!res.ok) throw new Error('HTTP ' + res.status);
          const newData = await res.json();
          
          renderMeta(el, newData);
          localStorage.setItem(cacheKey, JSON.stringify({ data: newData, timestamp: Date.now() }));

        } catch (err) {
          renderError(el, repo);
          console.error('获取仓库信息失败:', repo, err);
        }
      }
    })();
  </script>

  <footer class="footer">
    <p>&copy; 2024 waiwai24. All rights reserved.</p>
  </footer>
</body>
</html>