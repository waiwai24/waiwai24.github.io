# Make

Makefile 文件由一系列规则组成，每条规则形式如下：

```makefile
<target> : <prerequisites> 
[tab]  <commands>
```

冒号前面的部分，叫做 "目标"（target），冒号后面的部分叫做 "前置条件"（prerequisites）；第二行必须由一个 tab 键起首，后面跟着 "命令"（commands）。"目标" 是必需的，不可省略；"前置条件" 和 "命令" 都是可选的，但是两者之中必须至少存在一个。每条规则就明确两件事：构建目标的前置条件是什么，以及如何构建

* target：

  * 通常是文件名，指明 Make 命令所要构建的对象，目标可以是一个文件名，也可以是多个文件名，之间用空格分隔。

  * 除了文件名，目标还可以是某个操作的名字，这称为 "伪目标"（phony target）

  * 如果 Make 命令运行时没有指定目标，默认会执行 Makefile 文件的第一个目标。
* prerequisites：
  * 通常是一组文件名，之间用空格分隔
  * 只要有一个前置文件不存在，或者有过更新（前置文件的 last-modification 时间戳比目标的时间戳新），target 就需要重新构建

* command：
  * 必须以 tab 键开头


Makefile 文件语法：

* 井号（#）在 Makefile 中表示注释
* 允许使用等号自定义变量
* 内置变量：
  * `$(CC)` 指向当前使用的编译器
  * `$(MAKE)` 指向当前使用的 Make 工具
* 自动变量：
  * $@ 指代当前目标，就是 Make 命令当前构建的那个目标
  * $< 指代第一个前置条件
  * $^ 指代所有前置条件
  * `$(@D)` 和 `$(@F)` 分别指向 $@ 的目录名和文件名
  * `$(<D)` 和 `$(<F)` 分别指向 $< 的目录名和文件名。
* 假目标：使用 .PHONY: 关键字来定义
* 正常情况下，make 会打印每条命令，然后再执行，这就叫做回声（echoing）
* 命令的前面加上@，就可以关闭回声
* 通配符用来指定一组符合条件的文件名
* 模式匹配：允许对文件名，进行类似正则运算的匹配，主要用到的匹配符是%