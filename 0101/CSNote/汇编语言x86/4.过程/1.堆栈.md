# 堆栈



## 1.堆栈操作

LIFO结构（后进先出，last in first out），在程序执行中，堆栈通常用于存储**局部变量、函数参数、返回地址、寄存器值的临时保存区**以及处理函数调用时的切换

注意：栈在内存中是向下生长的



## 2.运行时的堆栈（32位）

* CPU用`ESP`(堆栈指针寄存器stack pointer register)对堆栈进行直接管理
* `ESP`寄存器中存放的是堆栈中某个位置的32位偏移量
* `ESP`寄存器不会被程序员直接修改控制，而是用**`call`,`ret`,`push`,`pop`**等指令间接修改的

### 2.1 入栈PUSH

```assembly
PUSH reg/mem16/mem32
PUSH imm32
```

32位入栈操作PUSH指令先把`ESP`减4，再把源操作数复制到栈顶指针指向的堆栈位置

### 2.2 出栈POP

```assembly
POP reg/mem16/mem32
```

POP指令先把ESP指向的堆栈元素复制到一个16/32位目的操作数中，再从堆栈中删除数据，栈顶指针增加4

### 2.3 PUSHFD，POPFD指令

直接使用该指令不带参数，标识将32位EFLAGS寄存器内容压入/弹出栈

注意：MOV指令不能把标识寄存器内容赋值给一个变量

