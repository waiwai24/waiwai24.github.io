# 冒险

> 在下一个时钟周期中下一条指令不能执行，这种情况被叫做流水线冒险



## 1.数据冒险

后面指令用到前面指令结果时，前面指令的结果还没产生

解决：

* 插入nop（一组气泡）避免数据冒险，但会导致流水线执行空指令，影响吞吐量

* 用硬件实现暂停/阻塞，但会导致流水线暂停，影响吞吐量

* **转发/旁路**避免数据冒险，当运算完成后在 Exec/Mem 流水段寄存器中已经存在后面指令可能需要用到的数据，我们可以不等WB阶段写回寄存器而是在硬件上稍加改动直接将流水段寄存器中的数据送往下一指令的ALU输入端

  * 虽然效果很好，但无法避免所有的流水线停顿

    ```
    lw x7, 100(x5) : IF ID EX MEM WB
    add x8, x7, x2 :    IF ID EX  MEM WB
    ```

  * load在MEM后，add指令所需要的数据才可以用，因此，还需要在中间加入一组nop




## 2.控制冒险

也叫分支冒险，决策依赖于一条指令的结果，而其他指令正在执行中。比如说分支跳转指令，必须等ALU给出结果后才知道该跳转到哪一条语句，即控制相关导致流水线产生计算错误

解决：

* 插入nop
* 通过暂停、阻塞
* 通过分支预测



## 3.结构冒险

当一条指令需要的硬件部件还在为之前的指令工作，而无法为这条指令提供服务，那就导致了结构冒险即硬件不支持多条指令在同一时钟周期执行

例如：只有一个存储器，同时存放数据和指令