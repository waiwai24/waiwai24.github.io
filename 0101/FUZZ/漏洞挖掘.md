# 漏洞挖掘

## 1.概述

挖掘方法分类：

* 静态分析方法：不需要运行程序，效率高，资源消耗低（词法分析，数据流分析，控制流分析，符号执行，污点传播分析，模型检查）
* 动态分析方法：需要运行程序，准确率高，误报率低（模糊测试，动态污点分析，动态符号执行）

符号执行和污点分析两类技术都分别支持静态分析和动态分析方法

凡是动态的相对静态的都是精准的，静态相对动态误报率高



## 2.符号执行

符号执行：使用符号值代替具体值，模拟程序的执行。（符号执行默认是静态的）

符号执行的三个关键点：

* 变量符号化：用一个符号值表示程序中的变量，所有被符号化的变量相关的变量的取值都会用符号值或符号值的表达式表示
* 程序执行模拟：最重要的是运算语句和分支语句的模拟
  * 运算语句：使用符号表达式的方式表示变量的值
  * 分支语句：收集到所有执行路径的约束条件表达式
* 约束求解：负责路径可达性进行判定及测试输入生成的工作，对于一条路径的约束求解表达式，可以采用约束求解器进行求解

特点：代价小，效率高，但会存在一个路径状态空间的路径爆炸问题

应用：

* 软件测试：用于创建高覆盖率的测试用例
* 漏洞挖掘：通过约束求解的方法来求解是否存在满足或违反漏洞分析规则的值（漏洞检测约束，路径约束）



## 3.污点分析

taint analysis 通过标记程序中的数据为（外部输入或内部数据））污点，跟踪程序处理污点数据的内部流程

分为污点传播分析（静态分析）和动态污点分析（动态分析）

基本思想及核心三要素：

* 污染源（来自网络/文件）
* 污点传播规则：扩散规则、消除规则
* 污点检测：在程序执行过程中的敏感位置（sink）进行污点判定，敏感位置主要包括程序跳转以及系统函数调用等

特点：适用于由输入参数引发漏洞的检测，具有较高的分析准确率，但对于大规模代码的分析，路径较多，分析性能受影响



## 4.词法分析

词法分析通过对代码进行基于文本或字符标识的匹配分析对比，以查找照符合特定特征和此法规则的危险函数，API或简单语句组合

特点：算法简单，检测性能高

缺点：只能进行表面的词法检测，不能进行语义方面的深层次分析



## 5.数据流分析

用来获取相关数据会沿着程序执行路径流动的信息分析技术，分析对象是程序执行路径上的数据流动或可能的取值

数据流分析分类：

* **过程内分析**：（函数内）
  * 流不敏感分析：按照代码行号
  * 流敏感分析：根据程序控制流图
  * 路径敏感分析：不仅考虑语句的先后顺序，还会考虑语句的可达性
* **和过程间分析**（跨函数）：
  * 考虑函数之间的数据流，即需要跟踪分析目标数据在函数之间的传递过程
  * context 上下文
  * 上下文不敏感分析
  * 上下文敏感分析

抽象语法树：程序抽象语法结构的树状表现形式

三地址码：一种中间语言，每个指令都有不多于三个的运算分量，每个运算分量都像是一个寄存器

控制流图CFG：通常是用于描述程序过程内的控制流的有向图

调用图CG：描述程序中过程之间的调用与被调用关系的有向图



## 6.程序切片

slice从程序中提取满足一定约束条件的代码片段（对指定变量施加影响的代码指令，或者指定变量所影响的代码片段）

根据计算方向的不同：

* 前向切片：计算方向与程序的运行方向是一致的
* 后向切片

程序依赖图PDG：可以表示为一个五元组，G={V，DDE,CDE,s,e}，DDE既有数据依赖，CDE又有控制依赖（流程上存在的依赖关系）

动态切片需要考虑程序的特定输入



## 7.插桩

在代码中插入一段我们自定义的代码

分类：

* 源码插桩
* 静态二进制插桩
* 动态二进制插桩（pin，intel）
