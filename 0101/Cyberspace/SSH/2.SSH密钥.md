# SSH 密钥

## 1.配置密钥登录

* `ssh-keygen`：建立密钥对，生成公私钥，配置密钥锁码
* `cd .ssh ； cat id_rsa.pub >> authorized_keys`：在服务器上安装公钥
* `vim /etc/ssh/sshd_config`，开启密钥登录，允许 root 用户登录，并禁用密码登录
  * PubkeyAuthentication yes
  * PermitRootLogin yes
  * PasswordAuthentication no
  * 如果上面禁用不成功，则 sshd_config.d 目录下有一个 50-cloud-init.conf 文件，里面只有一句话就是开启密码登录，把它删除就可以
  * 有时还需要配置权限 `chmod 700 ./.ssh ; chmod 600 ./.ssh/authorized_keys`
* `systemctl restart ssh` 或者 `/etc/init.d/ssh restart`：重启 ssh 服务



## 2.Windows 上密钥权限问题设置

```powershell
$keyPath = "key_path"
icacls $keyPath /inheritance:r
icacls $keyPath /grant:r "${env:USERNAME}:(R)"
icacls $keyPath
```

禁用从父文件夹继承来的权限，同时删除所有已继承的权限条目，并授予当前用户只读权限，最后查看权限结果