# 以太网

> 无连接，不可靠的服务



## 1.以太网概述

* 以太网是符合IEEE 802.3标准的局域网 
* ALOHA的介质是电磁波， 以太网的介质是电缆
* ALOHA历史：
  * “ALOHA”原为美国夏威夷地区人们相互之间的问候语，上世纪70年代夏威夷大学的一项研究项目取其为名，得到了如今的ALOHA协议（又称ALOHA系统、ALOHA网）。该协议原先旨在解决夏威夷群岛各个岛屿间的通信问题，是最早最基本的无线数据传输协议
  * ALOHA的通信机制非常简单：网络中发送端发起传输请求（Transmit Request）后即可立即发送数据，不存在授权信号（GRANT），也不需要在发送前检查线路（Channel）是否空闲。接收端在成功接收数据之后返回一个ACK信号，通知发送端传输成功
  * 由此带来的问题也非常明显：如果多个节点同时传输数据，线路内的数据将会发生冲突，导致数据出错。这种情况下接收端不发送ACK信号，发送端则在一段时间后重新发送数据，直到接收到ACK信号为止。可想而知，在冲突发生频率高的情况下，信号传输延迟可能变得非常大，传输效率非常低



## 2.以太网物理层

* 双绞线介质，以Hub （集线器）为中心节点
* 拓扑结构为星形，逻辑上仍然是总线形

* 集线器hub

  * 多端口转发器，主要功能是将**信号放大**并整形后再转发，消除信号传输的失真和衰减。属于物理层设备(工作在物理层)。

  * Hub主要用于小型LAN



## 3.MAC子层协议

### 3.1 广播信道的信号传输

> **以太网采用广播方式发送**

* 好处：任意一个主机传输的数据都能够到达 所有其它主机 
*  坏处： 所有这些主机竞争访问同一条链路 ，称它们处在同一个冲突域（collision  domain）中

### 3.2 ALOHA协议

* 纯ALOHA评价 ：

  * 反馈时间比较长 

  * 信道利用率<= 18

* 分槽（Slotted）ALOHA l

  * 站点发送数据时等待时间片的开始 
  *  避免用户发送的随意性，连续ALOHA变成离散 ALOHA 

*  分槽ALOHA评价 

  *  如果时间片的定义不合适，可能发送过程中还存 在冲突 
  *  信道利用率达到36% 

* ALOHA总体评价 

  * 站点发送数据时没有考虑其他站点是否正在发送 
  * 如果检测到其他站点在做什么，从而调整自己的 动作，可以提高信道的利用率

### 3.3 CSMA协议

> 载波侦听多路访问协议CSMA (Carrier Sense Multiple Access),在ALOHA的基础上加入了数据传输前的线路检查

#### 3.3.1 基本流程

* 某站点要发送数据时，先**侦听信道**；
* 如果空闲，则以概率P发送数据，以概率1-P推迟到下一个时间片，然后侦听信道
* 如果信道忙，则等下一个时间片，然后侦听信道；
* 重复上述过程，直到数据发送完

#### 3.3.2 三种基本方案

* 1-坚持CSMA  ：

  > 该方案相当于p持续性方案中p=1的情况，当发送端发起传输请求时，检查线路是否空闲，若空闲，则立即传输；若忙碌，则持续检查线路状态，直到线路空闲时无条件发送数据（p=1）。如果出现传输冲突，则发送端等待一段随机长度时间后再开始上述过程。1持续性方案用于CSMA/CD系统，如以太网（Ethernet）

* 非坚持CSMA 

  > 发送端的每次传输请求，都先检查线路是否空闲，若空闲，则立刻传输数据；若线路忙碌，则等待一段随机长度的时间后再重新尝试传输，以避免多个发送端同时提起发送请求的情况。并且每一次迭代都将增加等待时间的长度

* P-坚持CSMA 

  > 对于发送端的每次传输请求，都先检查线路是否空闲，若空闲，则存在两种情况，一种为立即发送数据（概率为p）；另一种则为延后一段固定的时间后再重新尝试传输（概率为1-p）。而如果线路忙碌，则持续等待，直到线路空闲后再开始上述过程。p持续性方案用于CSMA/CA系统，如WIFI以及其他封包无线电系统


三种CSMA是否完全避免了冲突呢？

例：站点A在发送数据，但由于信道的传播 时延，数据还未到达站点B，此时站点B要 发送数据，它侦听到信道是空闲的，于是 也开始发送数据，从而发生冲突

结论：在CSMA中冲突是不可避免的，必须进行冲突检测和处理！

### 3.4 CSMA/CD

> 具有冲突检测的载波侦听多路访问协议CSMA/CD(CSMA With Collision Detection）
>
> 总结：先听后发、边听边发、随机延迟后重发

基本思想：

* 某站点想要发送数据时，它必须先要**侦听信道**
* 如果信道空闲，立即发送数据，并进行**冲突检测**
* 如果忙碌，继续侦听信道，直到变为空闲，立即发送数据，并进行**冲突监测**
* 如果在发送数据的过程中检测到冲突，立即停止发送数据，并等待**随机长**（非坚持CSMA）的时间（指数回退算法），重新监听信道
* 当尝试到规定的次数时将放弃尝试并向主机报告错误

**信道浪费的时间=检测冲突所需要的时间**

### 3.5 MAC地址

* mac地址（物理地址）： IEEE802标准为每个厂商生产的网卡规定了一个 48位的全局地址，它是站点的全球唯一的标识符 ，与其物理位置无关
* MAC地址为6Byte: 00-11-25-B2-B8-65 
  *  前3个字节（高24位）由IEEE统一分配给厂商 l
  * 低24位由厂商分配给每一块网卡
* 分类：
  * 广播地址：全1，让局域网所有的设备接收到同一个帧
  * 组播地址：第40位位1，控制局域网的不放呢设备接收到同一个帧
  * 单播地址：某个特定网卡的地址
