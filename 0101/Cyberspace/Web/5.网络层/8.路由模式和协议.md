# 路由模式



## 1.分类

* 静态路由：由网络管理员设置并更新，有利于提高末端网络的安全访问控制，但缺乏动态适应网络拓扑结构变化的机制，当网络的拓扑结构发生变化时，必须由网络管理员手工修改路由配置。适用于连接末端网络的路由器，是有利于提高末端网络的安全访问控制
* 准静态路由：由核心节点专门负责收集路由信息，再向其他节点发布路由器信息
* 动态路由：路由器根据网络情况自动维护路由表



## 2.动态路由算法

> 实现**动态建立，维护，更新**路由表

### 2.1 局部路由协议

* 任何节点只与相邻节点交互
* 本地维护路由相关信息
* 根据每条链路的距离设定路由表，故也称为**距离-向量路由协议（distance vector routing protocol，V-D）**
* 典型的距离-向量路由协议RIP（routing information protocol）

#### 2.1.1 V-D路由算法

* 特点：
  * 非常简单的算法，易于配置维护使用
  * 收敛慢，路由环问题
  * 不适合于大的复杂的网络

* 算法思想：
  * 每个路由器动态计算维护一张距离向量表
  * 收到IP包后根据距离向量表决定如何转发
  * 路径代价的度量单位可以是时间延迟，物理距离，经过的路由器个数或其他参数，若本路由器不能到达目的网络，代价为无穷大
  * 每个路由器必须知道到他相邻路由器的距离
* 工作原理：
  * 每隔一段时间计算到相邻路由器的代价
  * 每隔一段时间相邻路由器之间交换一次距离向量表，由最佳路径和最小代价来更新自己的路由表（不考虑自己原来的路由信息）
* 存在的问题：
  * 在一个稳定的网络中，V-D算法工作的非常好。当网络出现故障时，可能回出现**路径环**，要打破路径环，则花费较长的时间，这就是**慢收敛问题**（即路由器C向路由器A报告到B的代价时没有考虑经过A，而A已经不可到达B了）
* 解决方法：
  * 水平分割法
  * 带出发更新的毒性反转法

### 2.2 全局路由协议

* 根据完整的网络全局拓扑信息计算到各个网络的最佳路径
* 因为需要了解每一条网络链路的状态，故也称其为**链路-状态路由协议（Link State Routing Protocol，L-S）**
* 典型的链路状态协议是**OSPF（Open Shortest Path First）**

#### 2.2.1 L-S算法

* 特点：
  * 链路状态报文一次性，无修改地向全网广播
  * 每个路由器再本地计算最短路径，相互不影响
  * 算法的收敛性得到保证
  * 但是对链路带宽和路由器性能要求高
* 算法思想：
  * 为每个路由器构造一张全网的拓扑结构图，使用**最短路径算法**为路由器计算出到每个节点的代价
* 工作原理：
  * 发现邻居节点
  * 测量到邻居节点的线路开销
  * 构造链路-状态报文
  * 广播链路-状态报文：
    * 用flooding方法广播到除自己和源端外的其他网络端口上（代价大）
    * 由于flooding会产生大量重复报文，可通过路由器标识和报文序号避免重复或无用的路由报文广播
  * 计算新路由
* 缺点：对链路带宽，路由器性能要求高



## 3.网络自治系统AS

* 背景：
  * Internet上联网的网络，主机，路由器非常多，在不对网络结构进行规划的前提下，很难在路由器进行全网的路由选择
  * 故把Internet划分成核心骨干网和一系列**自治系统（Autonomous System，AS）**并进行编号
* 特点;
  * AS内部所有路由器能互联互通，采用相同的路由协议，该协议称为**内部网关协议（Interior Gateway Protocol，IGP）**
  * 为了保证AS内部网络能够与Internet的骨干网连通，每个AS中都有一台路由器与骨干网中的一台路由器相连，二者也采用相同的路由协议，该协议称为**外部网关协议（Exterior Gateway Protocol，EGP）**

### 3.1 IGP

#### 3.1.1 RIP协议

*  Routing Information Protocol
* 基于V-D算法
* 报文分为更新报文（用于相邻站点路由表的交换）和请求报文（用于路由器发现网上其他运行的RIP协议）

#### 3.1.2 OSPF协议

* Open Shortest Path First
* 基于L-S算法

### 3.2 EGP

#### 3.2.1 BGP-4协议

* Border Gateway Protocol Version 4
* IGP主要目的是维持AS内部路由器之间的最优路径，EGP主要目的是维持AS之间的可达性信息
* 特点:
  * 基于V-D协议
  * 只与邻居BGP路由器交换BGP路由器信息

